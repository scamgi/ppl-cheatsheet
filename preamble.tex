% preamble.tex - Packages, custom commands, and styling

% --- Page Layout & Geometry ---
\usepackage[
    a4paper,
    margin=1.5cm,
    headheight=13.6pt
]{geometry}
\usepackage{fancyhdr} % For custom headers and footers
\usepackage{titlesec} % To control section formatting

% --- General Packages ---
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{lipsum}
\usepackage{xcolor}
\usepackage{textcomp} % Required for specific symbols
\newcommand{\code}[1]{\texttt{#1}}

% --- Code Listing Setup (with tcolorbox) ---
\usepackage{listings}
\usepackage{tcolorbox}
\tcbuselibrary{listings, breakable}

% --- Hyperlinks ---
\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=blue,
    urlcolor=blue,
    citecolor=blue,
    pdfsubject={A cheatsheet for Principles of Programming Languages},
    pdfkeywords={PPL, Racket, Haskell, Erlang, Programming, Cheatsheet}
}

% Define custom colors
\definecolor{codegray}{gray}{0.95}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{codeblue}{rgb}{0,0,1}
\definecolor{codegreen}{rgb}{0,0.5,0}

% --- Configure listings to handle special UTF-8 characters ---
% This is the key change to fix the compilation error.
  \lstset{
    inputencoding=utf8,
    extendedchars=true,
    literate=
      {Î»}{{$\lambda$}}1
      {セ}{--}1 % Replace Katakana 'se' with a dash as a placeholder
}


% --- Define base language styles for listings ---
\lstdefinestyle{racketstyle}{
  language=Lisp,
  morekeywords={define, lambda, if, else, cond, let, let*, begin, set!, require, provide, displayln},
  basicstyle=\ttfamily\small,
  keywordstyle=\color{codepurple}\bfseries,
  stringstyle=\color{codeblue},
  commentstyle=\color{codegreen}\itshape,
  numberstyle=\tiny\color{black!50},
  breaklines=true,
  showstringspaces=false,
}

\lstdefinestyle{haskellstyle}{
  language=Haskell,
  basicstyle=\ttfamily\small,
  keywordstyle=\color{codepurple}\bfseries,
  stringstyle=\color{codeblue},
  commentstyle=\color{codegreen}\itshape,
  numberstyle=\tiny\color{black!50},
  breaklines=true,
  showstringspaces=false,
}

\lstdefinestyle{erlangstyle}{
  language=Erlang,
  morekeywords={module, export, define, case, of, when, receive, after, fun, spawn, send},
  basicstyle=\ttfamily\small,
  keywordstyle=\color{codepurple}\bfseries,
  stringstyle=\color{codeblue},
  commentstyle=\color{codegreen}\itshape,
  numberstyle=\tiny\color{black!50},
  breaklines=true,
  showstringspaces=false,
}

% --- Create dedicated tcolorbox environments for each language ---
\newtcblisting{racketcode}{
  listing only,
  breakable,
  colback=codegray!50,
  colframe=black!20,
  boxrule=0.5pt,
  arc=2mm,
  left=5mm,
  listing options={style=racketstyle, numbers=left, numbersep=5pt}
}

\newtcblisting{haskellcode}{
  listing only,
  breakable,
  colback=codegray!50,
  colframe=black!20,
  boxrule=0.5pt,
  arc=2mm,
  left=5mm,
  listing options={style=haskellstyle, numbers=left, numbersep=5pt}
}

\newtcblisting{erlangcode}{
  listing only,
  breakable,
  colback=codegray!50,
  colframe=black!20,
  boxrule=0.5pt,
  arc=2mm,
  left=5mm,
  listing options={style=erlangstyle, numbers=left, numbersep=5pt}
}